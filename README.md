# Power Logger for Xilinx ZCU102 / ZCU106

A lightweight hardware + software toolkit for high-resolution power monitoring on Xilinx Zynq UltraScale+ evaluation boards.  
The system pairs a tiny **Arduino® Nano 33 BLE** (or a compatible 3 V MCU) with **TI INA226** current/voltage monitors—multiplexed through a **TCA9548A**—to capture rail-power data and stream it as CSV to a host PC.

> **Why?** When benchmarking FPGA workloads you often need a cheap, non-intrusive way to correlate board power with software events.  
> This project lets you do that with off-the-shelf parts and a single Python command.

---

## Hardware Requirements

| Item | Notes |
|------|-------|
| Xilinx ZCU102 / ZCU106 | Other boards may work with minor register tweaks. |
| Arduino Nano 33 BLE | Any 3 V MCU supported by *arduino-cli* should work. |
| Misc. cabling | SDA/SCL + External Trigger + GND from Nano to mux / sensors. |

---

## Wiring Overview

~~~text
Nano 33 BLE              ZCU10x Pmod I²C Header¹           Notes
---------------------    -------------------------------   ------------------------------
GND      ─────────────►  GND 
SDA (D20)─────────────►  SDA
SCL (D21)─────────────►  SCL
D2       ─────────────►  EXT_TRIG (optional)²              Align logs with PS/PL events
~~~

*The shunt connections (`VIN+`, `VIN-`) from each INA226 must be placed in-line with the board’s PS / PL rails; these are board-specific and are **not** shown above.*

---

## Software Requirements

* **arduino-cli ≥ 0.35** in your `$PATH`  
* Arduino core for your board (e.g. `arduino:mbed:nano33ble`)  
* **Python ≥ 3.8** with:

~~~bash
pip install pyserial
~~~

---

## Getting Started

### 1 . Clone

~~~bash
git clone https://github.com/vlsi-lab/power-logger.git
cd power-logger
~~~

### 2 . Build & Upload the Firmware

~~~bash
python power_log.py --target-board ZCU106 --fqbn arduino:mbed:nano33ble
~~~

Use `--port` to override auto-detection, and `--ext-trigger` if you wired **D2** to an external 3 V-logic source.

### 3 . Start Logging

~~~bash
# Continuous logging to power_log_<timestamp>.csv
python power_log.py
~~~

When `--ext-trigger` is active the logger waits for a HIGH pulse on **D2**:  
*first pulse → `#START`, second pulse → `#STOP`, and so on*.

### 4 . Visualise

~~~python
import pandas as pd, matplotlib.pyplot as plt
df = pd.read_csv("power_log_2025-06-07_12-15-42.csv")
df.plot()
plt.show()
~~~

---

## Data Format

* The sketch prints **tab-separated** values (`\t`).  
* When external triggering is enabled the first `#START` opens a new CSV and the corresponding `#STOP` closes it :contentReference[oaicite:1]{index=1}.  
* Headers (`value1 … valueN`) are autogenerated and grow if later rows get wider.

---

## Project Layout

~~~text
.
├── power-logger.ino   # Firmware entry point
├── INA226.{h,cpp}     # Lightweight driver for TI INA226   (MIT)
├── power_log.py       # Host-side CLI & logger             (GPL-3.0+)
└── LICENSE.md         # MIT license text
~~~

---

## Calibration & Boards

Default calibration words and LSBs for each rail/board live in `INA226.h` :contentReference[oaicite:2]{index=2}.  
Adjust them if you replace the shunt resistors.

---

## Contributing

1. Fork the repo and create your branch (`git checkout -b feature/foo`).  
2. Commit changes with meaningful messages.  
3. Open a pull request – tests and log snippets are welcome!  

---

## License

* GNU GPL v3 or later.  

---

## Authors

* Christian Conti  
* Alessandro Varaldi  

---

## Acknowledgements

* Texas Instruments INA226 data-sheet  
* Xilinx SCUI calibration values
